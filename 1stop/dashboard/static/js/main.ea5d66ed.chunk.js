(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{399:function(e,t,a){e.exports=a(632)},632:function(e,t,a){"use strict";a.r(t);var r=a(0),o=a.n(r),n=a(352),l=a.n(n),c=a(375),i=a(703),s=a(698),d=a(712),m=a(722),u=a(715),p=a(709),g=a(711),y=a(704),h=a(723),E=a(724),x=a(725),f=a(700),b=a(706),v=a(714),k=a(708),D=a(690),O=a(696),w=a(691),M=a(120),C=a(121),S=a(91),A=a(129),F=a(181),j=a(707),L=a(369),G=a(119),B=a(697),T=a(126),W=a(719),R=a(701),I=a(376),N=a(721),P=a(705),z=a(360),J=a(716),K=a(717),Y=a(357),X=a.n(Y),Q=a(356),$=a.n(Q);var V=e=>{var t;let{selectedCity:a="all",cityMapping:n={}}=e;const[l,c]=Object(r.useState)([]),[i,s]=Object(r.useState)(!1),[m,p]=Object(r.useState)(0),y=Object(r.useCallback)(()=>{const e={all:280,LYGRRATQ7EGG2:270,L4NE8GPX89J3A:185,LDK6Z980JTKXY:125,LXMC6DWVJ5N7W:95,LG0VGFKQ25XED:80},t={all:16,LYGRRATQ7EGG2:18,L4NE8GPX89J3A:14,LDK6Z980JTKXY:22,LXMC6DWVJ5N7W:12,LG0VGFKQ25XED:25},r={1:.87,2:1.12,3:1.18,4:.95},o=e[a]||e.all,n=t[a]||t.all,l=[],i=new Date,s=i.getFullYear(),d=i.getMonth(),m=Math.floor(d/3)+1;let u=null,g=o;for(let a=0;a<12;a++){const e=a-7;let t=s,c=m+e;for(;c<=0;)c+=4,t--;for(;c>4;)c-=4,t++;const i=Math.pow(1+n/100,.25),d=r[c],y=.95+.1*Math.random(),h=a>=8?Math.pow(1+1.1*n/100,.25):i;g=0===a?Math.round(o*d*y):Math.round(u*h*d*y);const E=u?100*(g/u-1):0;l.push({name:`Q${c} ${t}`,orders:g,growth:parseFloat(E.toFixed(1)),quarter:c,year:t,isProjection:a>=8}),0===e&&p(a),u=g}c(l)},[a]);Object(r.useEffect)(()=>{y()},[y]);return o.a.createElement(g.a,{sx:{p:3,boxShadow:"0 1px 3px rgba(0,0,0,0.12), 0 1px 2px rgba(0,0,0,0.24)",borderRadius:"8px"}},o.a.createElement(d.a,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2},o.a.createElement(u.a,{variant:"h6",fontWeight:"medium"},"Quarterly Orders for ",(e=>"all"===e?"All Cities":n[e]||e)(a)),o.a.createElement(J.a,{onClick:()=>s(!i),size:"small"},i?o.a.createElement($.a,null):o.a.createElement(X.a,null))),o.a.createElement(d.a,{height:320},o.a.createElement(D.a,{width:"100%",height:"100%"},o.a.createElement(P.a,{data:l,margin:{top:20,right:30,left:20,bottom:5}},o.a.createElement(w.a,{strokeDasharray:"3 3"}),o.a.createElement(M.a,{dataKey:"name"}),o.a.createElement(C.a,{yAxisId:"left",orientation:"left",stroke:"#3366cc",label:{value:"Orders",angle:-90,position:"insideLeft"}}),o.a.createElement(C.a,{yAxisId:"right",orientation:"right",stroke:"#dc3912",domain:[-5,40],label:{value:"Growth %",angle:90,position:"insideRight"}}),o.a.createElement(S.a,{content:o.a.createElement(e=>{let{active:t,payload:a,label:r}=e;if(t&&a&&a.length){const e=a[0].payload.isProjection;return o.a.createElement("div",{style:{backgroundColor:"#fff",padding:"10px",border:"1px solid #e0e0e0",boxShadow:"0 2px 4px rgba(0,0,0,0.1)",borderRadius:"4px"}},o.a.createElement("p",{style:{margin:"0 0 5px",fontWeight:"bold"}},r," ",e&&o.a.createElement("span",{style:{color:"#666",fontStyle:"italic"}},"(Projected)")),o.a.createElement("p",{style:{margin:"0",color:"#3366cc"}},"Orders: ",a[0].value),o.a.createElement("p",{style:{margin:"0",color:"#dc3912"}},"Growth: ",a[1].value,"%"))}return null},null)}),o.a.createElement(A.a,{payload:[{value:"Historical Orders",type:"rect",color:"#3366cc"},{value:"Projected Orders",type:"rect",color:"#8bb4ff"},{value:"Growth %",type:"line",color:"#dc3912"}]}),o.a.createElement(z.a,{x:null===(t=l[m])||void 0===t?void 0:t.name,stroke:"#666",strokeWidth:2,strokeDasharray:"5 5",label:{value:"Today",position:"insideTopLeft",fill:"#666",fontSize:12},yAxisId:"left"}),o.a.createElement(T.a,{yAxisId:"left",dataKey:"orders",name:"Orders",fill:"#3366cc",barSize:30,radius:[4,4,0,0],isAnimationActive:!0},l.map((e,t)=>o.a.createElement(G.a,{key:`cell-${t}`,fill:e.isProjection?"#8bb4ff":"#3366cc"}))),o.a.createElement(F.a,{yAxisId:"right",type:"monotone",dataKey:"growth",name:"Growth %",stroke:"#dc3912",strokeWidth:2,strokeDasharray:"5 5",dot:{r:4,strokeWidth:2},activeDot:{r:6}})))),i&&o.a.createElement(K.a,{in:i,timeout:"auto",unmountOnExit:!0},o.a.createElement(d.a,{mt:3,maxHeight:200,overflow:"auto"},o.a.createElement("table",{style:{width:"100%",borderCollapse:"collapse"}},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{style:{padding:"8px",borderBottom:"1px solid #ddd",textAlign:"left"}},"Quarter"),o.a.createElement("th",{style:{padding:"8px",borderBottom:"1px solid #ddd",textAlign:"right"}},"Orders"),o.a.createElement("th",{style:{padding:"8px",borderBottom:"1px solid #ddd",textAlign:"right"}},"Growth %"),o.a.createElement("th",{style:{padding:"8px",borderBottom:"1px solid #ddd",textAlign:"center"}},"Type"))),o.a.createElement("tbody",null,l.map((e,t)=>o.a.createElement("tr",{key:t,style:{backgroundColor:e.isProjection?"#f5f9ff":"inherit"}},o.a.createElement("td",{style:{padding:"8px",borderBottom:"1px solid #eee"}},e.name),o.a.createElement("td",{style:{padding:"8px",borderBottom:"1px solid #eee",textAlign:"right"}},e.orders),o.a.createElement("td",{style:{padding:"8px",borderBottom:"1px solid #eee",textAlign:"right"}},e.growth,"%"),o.a.createElement("td",{style:{padding:"8px",borderBottom:"1px solid #eee",textAlign:"center",color:e.isProjection?"#666":"inherit",fontStyle:e.isProjection?"italic":"normal"}},e.isProjection?"Projected":"Historical"))))))))},_=a(718),U=a(713);const H={LYGRRATQ7EGG2:"London",L4NE8GPX89J3A:"Ottawa",LDK6Z980JTKXY:"Kitchener-Waterloo",LXMC6DWVJ5N7W:"Hamilton",LG0VGFKQ25XED:"Calgary",all:"All Cities"},Z={LYGRRATQ7EGG2:"#FF0000",L4NE8GPX89J3A:"#00FF00",LDK6Z980JTKXY:"#0000FF",LXMC6DWVJ5N7W:"#FFA500",LG0VGFKQ25XED:"#800080"},q={LYGRRATQ7EGG2:{lat:42.9849,lng:-81.2453},L4NE8GPX89J3A:{lat:45.4215,lng:-75.6972},LDK6Z980JTKXY:{lat:43.4643,lng:-80.5204},LXMC6DWVJ5N7W:{lat:43.2557,lng:-79.8711},LG0VGFKQ25XED:{lat:51.0447,lng:-114.0719}},ee={"Tommy Suds":{lat:42.9727,lng:-81.278,city:"LYGRRATQ7EGG2",address:"79 Commissioners Rd W, London, ON N6J 4H9"},"London Sudz":{lat:42.9815,lng:-81.235,city:"LYGRRATQ7EGG2",address:"123 Dundas St, London, ON"},"Royal City Cleaners":{lat:43.0046,lng:-81.278,city:"LYGRRATQ7EGG2",address:"456 Oxford St, London, ON"},Browns:{lat:45.3494,lng:-75.7395,city:"L4NE8GPX89J3A",address:"1642 Merivale Rd, Nepean, ON K2G 4A1"},"Ace Cleaners":{lat:45.2959,lng:-75.9077,city:"L4NE8GPX89J3A",address:"471 Hazeldean Rd, Ottawa, ON K2L 4B8"},Khawla:{lat:45.3103,lng:-75.6104,city:"L4NE8GPX89J3A",address:"585 Flagstaff Drive, Ottawa, ON"},Spins:{lat:45.4372,lng:-75.6556,city:"L4NE8GPX89J3A",address:"320 McArthur Ave. B, Vanier, ON K1L 5G2"},"Centreville Laundry":{lat:43.4404,lng:-80.4469,city:"LDK6Z980JTKXY",address:"1077 Weber St E Unit #1, Kitchener, ON N2A 3Y5"},"KW Washateria":{lat:43.4723,lng:-80.5449,city:"LDK6Z980JTKXY",address:"321 University Ave, Waterloo, ON"},"Laundry Closet":{lat:43.2356,lng:-79.8187,city:"LXMC6DWVJ5N7W",address:"273 Kenilworth Ave N, Hamilton, ON L8H 4S8"},"Soapy Bubbles":{lat:43.2526,lng:-79.8439,city:"LXMC6DWVJ5N7W",address:"750 Main St E, Hamilton, ON L8M 1L1"},Marbank:{lat:51.0714,lng:-113.9826,city:"LG0VGFKQ25XED",address:"920 36 St NE #139, Calgary, AB T2A 6L8"},"Calgary Cleaners":{lat:51.0447,lng:-114.0719,city:"LG0VGFKQ25XED",address:"555 Centre St, Calgary, AB"}},te={LYGRRATQ7EGG2:["Tommy Suds","London Sudz","Royal City Cleaners"],L4NE8GPX89J3A:["Browns","Ace Cleaners","Khawla","Spins"],LDK6Z980JTKXY:["Centreville Laundry","KW Washateria"],LXMC6DWVJ5N7W:["Laundry Closet","Soapy Bubbles"],LG0VGFKQ25XED:["Marbank","Calgary Cleaners"]},ae={};Object.keys(q).forEach(e=>{ae[e]=[],(te[e]||[]).forEach((t,a)=>{var r;const o=`${e.substring(0,5)}_${t.replace(/\s+/g,"_")}`;ae[e].push({id:o,name:t,address:(null===(r=ee[t])||void 0===r?void 0:r.address)||`Unknown Address in ${H[e]}`})});const t=5-ae[e].length;if(t>0)for(let a=0;a<t;a++){const t=H[e],r=["Cleaners","Laundry","Wash & Fold","Express Wash","Laundromat"],o=`${t} ${r[a%r.length]} ${a+1}`,n=`${e.substring(0,5)}_LAUNDRY_${a+1}`;ae[e].push({id:n,name:o,address:`123 Main St, ${t}`})}});const re=e=>{if(!e)return!1;try{const a=Object(_.a)(e),r=new Date;return a.getMonth()===r.getMonth()&&a.getFullYear()===r.getFullYear()}catch(t){return!1}},oe=e=>{const t=e.cityId||e.city_id||e.city;if(t&&q[t])return t;const a=e.city||e.cityName;if(a)for(const[r,o]of Object.entries(H))if(o.toLowerCase()===a.toLowerCase())return r;return"LYGRRATQ7EGG2"};var ne=a(720);const le={LYGRRATQ7EGG2:"London",L4NE8GPX89J3A:"Ottawa",LDK6Z980JTKXY:"Kitchener-Waterloo",LXMC6DWVJ5N7W:"Hamilton",LG0VGFKQ25XED:"Calgary",all:"All Cities"},ce={LYGRRATQ7EGG2:{name:"London",population:4e5,yearlyGrowthFactor:1.35,operationalSince:new Date("2022-12-01"),marketMaturity:.15,minWeeklyOrders:80},L4NE8GPX89J3A:{name:"Ottawa",population:105e4,yearlyGrowthFactor:1.28,operationalSince:new Date("2023-03-15"),marketMaturity:.35,minWeeklyOrders:35},LDK6Z980JTKXY:{name:"Kitchener-Waterloo",population:575e3,yearlyGrowthFactor:1.32,operationalSince:new Date("2023-06-01"),marketMaturity:.3,minWeeklyOrders:40},LXMC6DWVJ5N7W:{name:"Hamilton",population:57e4,yearlyGrowthFactor:1.25,operationalSince:new Date("2023-09-10"),marketMaturity:.35,minWeeklyOrders:30},LG0VGFKQ25XED:{name:"Calgary",population:13e5,yearlyGrowthFactor:1.4,operationalSince:new Date("2023-11-20"),marketMaturity:.2,minWeeklyOrders:25}},ie={0:.98,1:1,2:1.05,3:1.08,4:.95},se={0:.95,1:.98,2:1.02,3:1.05,4:1.08,5:1.12,6:1.1,7:1.05,8:1.1,9:1.05,10:1,11:.98};function de(e,t){let a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:52;if(!e||0===e.length)return{combined:[],metrics:{totalAnnualOrders:0,averageMonthlyOrders:0,projectedGrowthPercent:0}};const r=function(e,t){if(!e||0===e.length)return[];const a=le[t]||t;return e.filter(e=>"all"===t?void 0!==e.total||Object.values(le).filter(e=>"All Cities"!==e).some(t=>void 0!==e[t]):void 0!==e[a]).map(e=>{let r;return r="all"===t?void 0!==e.total?e.total:Object.values(le).filter(e=>"All Cities"!==e).reduce((t,a)=>t+(e[a]||0),0):e[a]||0,{name:e.name,orders:r,month:e.month||null,date:e.date||null}}).filter(e=>e.orders>0)}(e,t),o=new Date(2024,9,31),n=r.filter(e=>{let t;try{const r=e.name.split(" "),o=r[0],n=parseInt(r[1]),l={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};void 0===l[o]||isNaN(n)||(t=new Date(n,l[o],1))}catch(a){console.error("Error parsing date from month name:",e.name,a)}return!t||t<=o}),l=n.length>0?n[n.length-1]:r[r.length-1];if(!l)return{combined:[],metrics:{totalAnnualOrders:0,averageMonthlyOrders:0,projectedGrowthPercent:0}};const c="all"!==t?ce[t]:{name:"All Cities",yearlyGrowthFactor:1.28,marketMaturity:.25,minWeeklyOrders:85};let i,s=l.orders/4.3;if(s=Math.max(s,c.minWeeklyOrders||20),n.length>=3){const e=n.map(e=>e.orders);i=e.reduce((e,t)=>e+t,0)/e.length/4.3,i=Math.max(i,c.minWeeklyOrders||20)}else i=s;const[d,m]=l.name.split(" "),u={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11}[d],p=parseInt(m);new Date(p,u,15);new Date;const g=c.yearlyGrowthFactor||1.28,y=Math.pow(g,1/52)*(1-.15*(c.marketMaturity||.25)),h=[];let E=s,x=new Date;for(let O=0;O<a;O++){const e=Object(ne.a)(x,O),t=Math.floor(e.getDate()/7),a=e.getMonth();E*=y,E*=(ie[t]||1)*(se[a]||1),E*=.03*Math.random()-.015+1,E=Math.max(E,c.minWeeklyOrders||20);const r=Object(R.a)(e,"MMM d, yyyy"),o=Object(R.a)(e,"MMM d");h.push({name:o,fullname:r,orders:Math.round(E),projected:!0,month:Object(R.a)(e,"yyyy-MM"),week:Object(R.a)(e,"yyyy-MM-dd")})}const f=function(e){if(!e||e.length<2)return e;const t=[];for(let a=0;a<e.length;a++){const r=e[a],o=r.name.split(" "),n=o[0],l=parseInt(o[1]),c={Jan:0,Feb:1,Mar:2,Apr:3,May:4,Jun:5,Jul:6,Aug:7,Sep:8,Oct:9,Nov:10,Dec:11};if(void 0===c[n]||isNaN(l)){t.push(r);continue}const i=c[n],s=(new Date(l,i,1),new Date(l,i+1,0).getDate()),d=Math.ceil(s/7),m=e[a+1];let u=r.orders;m&&(u=m.orders);for(let p=0;p<d;p++){const o=Math.min(7*p+1,s),n=new Date(l,i,o),c=p/d;let m;if(a<e.length-1)m=r.orders*(1-c)+u*c;else{const e=1+.1*(c-.5);m=r.orders*e}const g=ie[p]||1;m*=g;const y=.04*Math.random()-.02+1;m*=y;const h=Object(R.a)(n,"MMM d"),E=Object(R.a)(n,"MMM d, yyyy");t.push({name:h,fullname:E,orders:Math.round(m/d),month:Object(R.a)(n,"yyyy-MM"),week:Object(R.a)(n,"yyyy-MM-dd"),projected:!1})}}return t}(r),b=h.reduce((e,t)=>e+t.orders,0),v=b/4.3,k=b/h.length,D=100*(k/i-1);return{combined:[...f.map(e=>({...e,projected:!1})),...h],weeklyHistoricalData:f,projectedData:h,metrics:{totalAnnualOrders:Math.round(12*v),averageMonthlyOrders:Math.round(4.3*k),averageWeeklyOrders:Math.round(k),projectedGrowthPercent:D,cityName:le[t]||"Unknown"}}}a(699);const me=["#1E88E5","#26A69A","#FFA726","#EF5350","#AB47BC","#66BB6A","#EC407A"];var ue=()=>{const[e,t]=Object(r.useState)(!0),[a,n]=Object(r.useState)([]),[l,c]=Object(r.useState)("LYGRRATQ7EGG2"),[i,s]=Object(r.useState)(Object(W.a)(new Date,12)),[p,P]=Object(r.useState)(new Date),[z,J]=Object(r.useState)([]),[K,Y]=Object(r.useState)([]),[X,Q]=Object(r.useState)("all"),[$,te]=Object(r.useState)("all"),[ne,le]=Object(r.useState)(null),[ce,ie]=Object(r.useState)(11),[se,ue]=Object(r.useState)(null),[pe,ge]=Object(r.useState)(null),ye=Object(r.useMemo)(()=>{const e={},t={};Object.keys(ae).forEach(e=>{ae[e].forEach(e=>{t[e.address]=e.name})});const r={};return a.forEach(e=>{if(e.cleaning&&e.cleaning.cleaner&&e.pickup&&e.pickup.to){const t=e.cleaning.cleaner,a=e.pickup.to;r[t]||(r[t]={}),r[t][a]=(r[t][a]||0)+1}}),Object.keys(r).forEach(o=>{const n=r[o];let l=null,c=0;if(Object.keys(n).forEach(e=>{n[e]>c&&(l=e,c=n[e])}),l&&t[l])return void(e[o]=t[l]);let i=null,s=0;if(Object.keys(t).forEach(e=>{const a=e.toLowerCase().split(/[,\s]+/),r=l?l.toLowerCase().split(/[,\s]+/):[];let o=0;r.forEach(e=>{e.length>2&&a.includes(e)&&o++});const n=o/Math.max(a.length,r.length);n>s&&(s=n,i=t[e])}),i&&s>.3)e[o]=i;else{const t={};a.forEach(e=>{e.cleaning&&e.cleaning.cleaner===o&&e.cityId&&(t[e.cityId]=(t[e.cityId]||0)+1)});let n=null,l=0;if(Object.keys(t).forEach(e=>{t[e]>l&&(l=t[e],n=e)}),n&&ae[n]&&ae[n].length>0){const t=Object.keys(r).indexOf(o)%ae[n].length;e[o]=ae[n][t].name}else e[o]=`Laundromat ${o.substring(0,8)}`}}),e.q8dvkNhc9ZbCswGUbllUdoqOr6J3="Tommy Suds",e.Z1qpZ7LByNWjT4QmjxZdCgEQogH3="London Sudz",e.yXwnUIE3EPX1sSfpot3rw5MbbVs1="Royal City Cleaners",e.hchYpbQECAQk2e2eyruUTxU8YP42="Browns",e},[a]);Object(r.useEffect)(()=>{(async()=>{try{console.log("Attempting to fetch data...");const o=await fetch("/appointments.json");if(console.log("Response status:",o.status),!o.ok)throw new Error(`HTTP error! status: ${o.status}`);const l=await o.json();if(console.log("Data loaded successfully, total records:",l.length),l.length>0){var e;const t=l[0];console.log("Sample record:",t),console.log("Date fields found:",{serviceDate:null===(e=t.pickup)||void 0===e?void 0:e.serviceDate,service_date:t.service_date,createdAt:t.createdAt,updatedAt:t.updatedAt})}try{const e=l.map(e=>{try{var t;const r=(null===(t=e.pickup)||void 0===t?void 0:t.serviceDate)||e.service_date||e.createdAt||e.updatedAt;if(!r)return null;const o=new Date(r);return isNaN(o.getTime())?null:o}catch(a){return null}}).filter(e=>null!==e);if(e.length>0){const t=new Date(Math.min(...e.map(e=>e.getTime()))),a=new Date(Math.max(...e.map(e=>e.getTime())));console.log("Date range:",{earliest:t.toISOString(),latest:a.toISOString()}),t<i&&s(t),a<p&&P(a)}else console.log("No valid dates found in the data")}catch(a){console.error("Error calculating date range:",a)}n(l),t(!1)}catch(r){console.error("Error fetching data:",r),console.log("Trying fallback data...");const e=Array.from({length:50},(e,t)=>({id:`sample-${t}`,city_id:"LYGRRATQ7EGG2",customer_type:t%2===0?"Residential":"Commercial",laundromat_id:"LYGRRATQ7EGG"+Math.floor(t/10),laundromat_name:`Laundromat ${Math.floor(t/10)}`,revenue:20+80*Math.random(),address:`${100+t} Richmond St, London, Ontario`,pickup:{serviceDate:new Date(2023,9,t%30+1).toISOString()}}));console.log("Using fallback data:",e.length,"records"),n(e),t(!1)}})()},[]),Object(r.useEffect)(()=>{console.log("City changed to:",l,"Setting map center:",q[l]),"all"===l?(le(q.LYGRRATQ7EGG2),ie(8)):(le(q[l]),ie(11))},[l]),Object(r.useEffect)(()=>{se&&ne&&(console.log("Panning map to:",ne,"with zoom:",ce),se.panTo(ne),se.setZoom(ce))},[ne,ce,se]),Object(r.useEffect)(()=>{(async()=>{if(!a.length)return;console.log("MAP DEBUG - Total orders:",a.length);const e=a.reduce((e,t)=>{const a=oe(t);return e[a]=(e[a]||0)+1,e},{});if(console.log("MAP DEBUG - Orders by city:",e),console.log("MAP DEBUG - Currently selected city:",l),a.length>0){const e=a[0];console.log("MAP DEBUG - Sample appointment:",{id:e.id||e.appointmentId,cityId:e.cityId,city_id:e.city_id,city:e.city,normalizedCityId:oe(e)})}const t="all"===l?a:a.filter(e=>{const t=oe(e),r=t===l;return a.indexOf(e)<5&&console.log(`MAP DEBUG - App ${e.id||e.appointmentId}: cityId=${e.cityId}, normalizedCityId=${t}, matches=${r}`),r});console.log(`MAP DEBUG - After filtering, ${t.length} appointments match the selected city`);const r=await(async e=>{const t={},a=new Set;e.forEach(e=>{const t=oe(e);t&&a.add(t)}),console.log("MAP DEBUG - getLaundromatLocations - City IDs:",Array.from(a)),0===a.size&&(Object.keys(q).forEach(e=>a.add(e)),console.log("MAP DEBUG - No city IDs found, using all cities")),Array.from(a).forEach(e=>{ae[e]&&(t[e]=ae[e].map(t=>({id:t.id,name:t.name,address:t.address,color:Z[e]||"#000000",orders:[],cityId:e})))}),e.forEach(e=>{const a=oe(e);if(e.laundromat_id||e.laundromatId,!a||!t[a])return;const r=Math.floor(Math.random()*t[a].length);t[a][r].orders.push(e)});const r=Object.values(t).flat();return console.log(`MAP DEBUG - getLaundromatLocations - Generated ${r.length} laundromat locations`),r.map(e=>{const t=e.cityId,a=q[t]||q.LYGRRATQ7EGG2,r=ee[e.name];if(r&&r.city===t)return{...e,lat:r.lat,lng:r.lng};const o=Math.random()*Math.PI*2,n=.01+.02*Math.random(),l=a.lat+Math.cos(o)*n,c=a.lng+Math.sin(o)*n;return{...e,lat:l,lng:c}})})(t);console.log("MAP DEBUG - Laundromat locations:",r),Y(r);const o=await(async e=>{console.log(`MAP DEBUG - getOrderLocations - Starting with ${e.length} appointments`);const t=e.reduce((e,t)=>{const a=oe(t);return e[a]=(e[a]||0)+1,e},{});console.log("MAP DEBUG - getOrderLocations - City distribution:",t);const a=Math.min(e.length,500),r=e.slice(0,a),o=new Set;r.forEach(e=>{const t=oe(e);t&&o.add(t)}),console.log("MAP DEBUG - getOrderLocations - Unique cities in sample:",Array.from(o));const n={},l={};Array.from(o).forEach(e=>{ae[e]&&ae[e].forEach(t=>{n[t.id]={name:t.name,address:t.address,cityId:e,color:Z[e]||"#000000"},l[t.name]={id:t.id,address:t.address,cityId:e,color:Z[e]||"#000000"}})});const c=r.map(e=>{var t;const a=oe(e),r=q[a]||q.LYGRRATQ7EGG2;let o=e.laundromat_id||e.laundromatId,l=null;if(!o&&ae[a]){const e=Math.floor(Math.random()*ae[a].length);o=ae[a][e].id,l=ae[a][e].name}else o&&n[o]&&(l=n[o].name);const c=(null===(t=n[o])||void 0===t?void 0:t.color)||Z[a]||"#000000";let i,s;const d=l?ee[l]:null;if(d){const e=.005+.01*Math.random(),t=Math.random()*Math.PI*2;i=d.lat+Math.cos(t)*e,s=d.lng+Math.sin(t)*e}else{const e=.01+.02*Math.random(),t=Math.random()*Math.PI*2;i=r.lat+Math.cos(t)*e,s=r.lng+Math.sin(t)*e}return{lat:i,lng:s,laundromatColor:c,cityId:a,orderDetails:{customerType:e.customerType||e.customer_type||"Unknown",revenue:parseFloat(e.revenue||e.invoiceTotal||0),address:e.address||(e.pickup?e.pickup.to:"Unknown Address"),laundromatId:o,laundromatName:l,city:H[a]||"Unknown"}}});return console.log(`MAP DEBUG - getOrderLocations - Generated ${c.length} order markers`),c})(t);console.log("MAP DEBUG - Order locations:",o),J(o)})()},[a,l]);Object(r.useMemo)(()=>{const e=[],t=new Date,a=new Date(t.getFullYear(),t.getMonth()-1,1);for(let r=0;r<24;r++){const t=new Date(a.getFullYear(),a.getMonth()-r,1);e.push({value:{month:t.getMonth(),year:t.getFullYear()},label:t.toLocaleString("default",{month:"long",year:"numeric"})})}return e},[]);const he=Object(r.useMemo)(()=>{console.log("Filtering appointments with:",{totalAppointments:a.length,selectedCity:l,startDate:i.toISOString(),endDate:p.toISOString(),customerTypeFilter:X,sampleAppointment:a[0]});const e=a.filter(e=>{var t;if(e.id===(null===(t=a[0])||void 0===t?void 0:t.id)&&console.log("Sample appointment structure:",e),"all"!==l&&e.cityId!==l)return!1;if("all"!==X&&e.customerType!==X)return!1;if("all"!==$&&(!e.cleaning||e.cleaning.cleaner!==$))return!1;let r=!1,o=!1;if(e.pickup&&e.pickup.serviceDate){o=!0;try{var n,c;const t=new Date(e.pickup.serviceDate);e.id!==(null===(n=a[0])||void 0===n?void 0:n.id)&&e.appointmentId!==(null===(c=a[0])||void 0===c?void 0:c.appointmentId)||(console.log("Parsed pickup date:",t),console.log("Start date:",i),console.log("End date:",p),console.log("Is in range:",!(t<i||t>p))),t<i||t>p||(r=!0)}catch(s){console.error("Error parsing date:",e.pickup.serviceDate,s)}}if(!r&&e.service_date){o=!0;try{const t=new Date(e.service_date);t<i||t>p||(r=!0)}catch(s){console.error("Error parsing service_date:",e.service_date,s)}}if(!r&&e.createdAt){o=!0;try{const t=new Date(e.createdAt);t<i||t>p||(r=!0)}catch(s){console.error("Error parsing createdAt:",e.createdAt,s)}}return!(o&&!r)});return console.log("Filtered appointments:",e.length),e},[a,l,X,$,i,p]),Ee=(Object(r.useMemo)(()=>(e=>{try{const a={};return Object.keys(H).forEach(e=>{a[e]={id:e,name:H[e],orders:0,revenue:0,avgOrderValue:0,customers:new Set,laundromats:new Set,customerTypes:{Residential:0,Commercial:0,Airbnb:0,Monthly:0}}}),e.forEach(e=>{const t=e.cityId;if(!a[t])return;a[t].orders+=1;const r=parseFloat(e.invoiceTotal||0);a[t].revenue+=isNaN(r)?0:r,e.customerId&&a[t].customers.add(e.customerId),e.cleaning&&e.cleaning.cleaner&&a[t].laundromats.add(e.cleaning.cleaner),e.customerType&&(a[t].customerTypes[e.customerType]=(a[t].customerTypes[e.customerType]||0)+1)}),Object.keys(a).forEach(e=>{const t=a[e];t.avgOrderValue=t.orders>0?t.revenue/t.orders:0,t.customers=t.customers.size,t.laundromats=t.laundromats.size}),Object.values(a)}catch(t){return console.error("Error calculating city statistics:",t),[]}})(he),[he]),Object(r.useMemo)(()=>(e=>{try{const a={},r={};return e.forEach(e=>{var t,o,n;if(!e.customerId||!e.cleaning)return;const l=e.customerId,c=e.cleaning.cleaner;if((null===(t=e.pickup)||void 0===t?void 0:t.serviceDate)&&new Date(e.pickup.serviceDate),a[c]||(a[c]={id:c,name:c,orders:0,revenue:0,customers:new Set,returningCustomers:new Set,turnaroundTimes:[],orderWeights:[],averageOrderValue:0}),!a[c])return;a[c].orders+=1;const i=parseFloat(e.invoiceTotal||0);if(a[c].revenue+=isNaN(i)?0:i,a[c].customers.add(l),r[l]===c?a[c].returningCustomers.add(l):r[l]=c,(null===(o=e.pickup)||void 0===o?void 0:o.serviceDate)&&(null===(n=e.drop)||void 0===n?void 0:n.serviceDate)){const t=new Date(e.pickup.serviceDate),r=(new Date(e.drop.serviceDate)-t)/864e5;a[c].turnaroundTimes.push(r)}if(e.cleaning.orderDetails&&e.cleaning.orderDetails.washFoldWeight){const t=parseFloat(e.cleaning.orderDetails.washFoldWeight);isNaN(t)||a[c].orderWeights.push(t)}}),Object.keys(a).forEach(e=>{const t=a[e];t.averageOrderValue=t.orders>0?t.revenue/t.orders:0;const r=t.turnaroundTimes.reduce((e,t)=>e+t,0);t.averageTurnaroundDays=t.turnaroundTimes.length>0?r/t.turnaroundTimes.length:0;const o=t.orderWeights.reduce((e,t)=>e+t,0);t.averageOrderWeight=t.orderWeights.length>0?o/t.orderWeights.length:0,t.customerCount=t.customers.size,t.returningCustomerCount=t.returningCustomers.size,t.retentionRate=t.customerCount>0?t.returningCustomerCount/t.customerCount:0,delete t.customers,delete t.returningCustomers}),Object.values(a).filter(e=>e.orders>=5).sort((e,t)=>t.orders-e.orders).slice(0,3)}catch(t){return console.error("Error calculating laundromat statistics:",t),[]}})(he).map(e=>{const t=e.customers>0?e.returningCustomers/e.customers:0;return{...e,retentionRate:t}}),[he])),xe=Object(r.useMemo)(()=>(e=>{try{const a={};return e.forEach(e=>{e.customerType&&(a[e.customerType]=(a[e.customerType]||0)+1)}),Object.entries(a).map(e=>{let[t,a]=e;return{name:t,value:a}})}catch(t){return console.error("Error calculating customer type distribution:",t),[]}})(he),[he]),fe=Object(r.useMemo)(()=>{const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;try{const r=new Date,o={};for(let e=0;e<t;e++){const t=Object(W.a)(r,e);if(t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear())continue;const a=Object(R.a)(t,"yyyy-MM"),n=Object(R.a)(t,"MMM yyyy");o[a]={name:n,month:a,date:t,total:0},Object.values(H).forEach(e=>{o[a][e]=0})}return e.forEach(e=>{if(e.pickup&&e.pickup.serviceDate)try{const a=Object(_.a)(e.pickup.serviceDate);if(re(e.pickup.serviceDate))return;const r=Object(R.a)(a,"yyyy-MM");if(!o[r])return;o[r].total+=1;const n=H[e.cityId];n&&(o[r][n]=(o[r][n]||0)+1)}catch(t){}}),Object.values(o).sort((e,t)=>e.month.localeCompare(t.month))}catch(a){return console.error("Error calculating monthly order trend:",a),[]}}("all"===l?a:a.filter(e=>e.cityId===l),12),t=new Date;return e.filter(e=>{const a=new Date(e.date);return!(a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear())})},[a,l]),be=(Object(r.useMemo)(()=>{const e=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:12;try{const r=new Date,o={};for(let e=0;e<t;e++){const t=Object(W.a)(r,e);if(t.getMonth()===r.getMonth()&&t.getFullYear()===r.getFullYear())continue;const a=Object(R.a)(t,"yyyy-MM"),n=Object(R.a)(t,"MMM yyyy");o[a]={name:n,month:a,date:t,orderCount:0,totalRevenue:0,value:0}}return e.forEach(e=>{if(e.pickup&&e.pickup.serviceDate)try{const a=Object(_.a)(e.pickup.serviceDate);if(re(e.pickup.serviceDate))return;const r=Object(R.a)(a,"yyyy-MM");if(!o[r])return;const n=parseFloat(e.invoiceTotal||0);!isNaN(n)&&n>0&&(o[r].orderCount+=1,o[r].totalRevenue+=n)}catch(t){}}),Object.values(o).forEach(e=>{e.value=e.orderCount>0?e.totalRevenue/e.orderCount:0}),Object.values(o).sort((e,t)=>e.month.localeCompare(t.month)).map(e=>{let{name:t,value:a,date:r}=e;return{name:t,value:parseFloat(a.toFixed(2)),date:r}})}catch(a){return console.error("Error calculating average order value trend:",a),[]}}("all"===l?a:a.filter(e=>e.cityId===l),12),t=new Date;return e.filter(e=>{const a=new Date(e.date);return!(a.getMonth()===t.getMonth()&&a.getFullYear()===t.getFullYear())})},[a,l]),Object(r.useMemo)(()=>(e=>{try{const a={},r={},o={};e.forEach(e=>{if(!e.customerId||!e.pickup||!e.pickup.serviceDate)return;const t=e.customerId;try{const l=Object(_.a)(e.pickup.serviceDate);a[t]=(a[t]||0)+1,(!r[t]||l<r[t])&&(r[t]=l),(!o[t]||l>o[t])&&(o[t]=l)}catch(n){}});const n=Object.keys(a).length,l=Object.values(a).filter(e=>e>1).length,c=n>0?l/n:0,i=n>0?Object.values(a).reduce((e,t)=>e+t,0)/n:0;let s=0,d=0;return Object.keys(a).forEach(e=>{if(a[e]>1&&r[e]&&o[e]){const t=Object(U.a)(o[e],r[e]);t>0&&(s+=t,d++)}}),{totalCustomers:n,returningCustomers:l,retentionRate:c,averageOrdersPerCustomer:i,averageCustomerLifetime:d>0?s/d:0}}catch(t){return console.error("Error calculating customer retention metrics:",t),{totalCustomers:0,returningCustomers:0,retentionRate:0,averageOrdersPerCustomer:0,averageCustomerLifetime:0}}})(he),[he]),Object(r.useMemo)(()=>(e=>{try{const a={};return e.forEach(e=>{if(e.pickup&&e.pickup.driver){const t=e.pickup.driver;a[t]||(a[t]={id:t,totalPickups:0,totalDropoffs:0,totalDistance:0,totalPay:0,completedPickups:0,completedDropoffs:0,cancelledServices:0}),a[t].totalPickups++,"COMPLETED"===e.pickup.status?a[t].completedPickups++:"CANCELLED_BY_SELLER"===e.pickup.status&&a[t].cancelledServices++;const r=parseFloat(e.pickup.distance||0);isNaN(r)||(a[t].totalDistance+=r);const o=parseFloat(e.pickup.basePay||0);isNaN(o)||(a[t].totalPay+=o)}if(e.dropoff&&e.dropoff.driver){const t=e.dropoff.driver;a[t]||(a[t]={id:t,totalPickups:0,totalDropoffs:0,totalDistance:0,totalPay:0,completedPickups:0,completedDropoffs:0,cancelledServices:0}),a[t].totalDropoffs++,"COMPLETED"===e.dropoff.status?a[t].completedDropoffs++:"CANCELLED_BY_SELLER"===e.dropoff.status&&a[t].cancelledServices++;const r=parseFloat(e.dropoff.distance||0);isNaN(r)||(a[t].totalDistance+=r);const o=parseFloat(e.dropoff.basePay||0);isNaN(o)||(a[t].totalPay+=o)}}),Object.keys(a).forEach(e=>{const t=a[e];t.totalServices=t.totalPickups+t.totalDropoffs,t.completedServices=t.completedPickups+t.completedDropoffs,t.completionRate=t.totalServices>0?t.completedServices/t.totalServices:0,t.avgDistancePerService=t.totalServices>0?t.totalDistance/t.totalServices:0,t.avgPayPerDistance=t.totalDistance>0?t.totalPay/t.totalDistance:0}),Object.values(a)}catch(t){return console.error("Error calculating driver performance metrics:",t),[]}})(he),[he]),Object(r.useMemo)(()=>(e=>{try{const a={Q1:{name:"Q1 (Jan-Mar)",orders:0,revenue:0},Q2:{name:"Q2 (Apr-Jun)",orders:0,revenue:0},Q3:{name:"Q3 (Jul-Sep)",orders:0,revenue:0},Q4:{name:"Q4 (Oct-Dec)",orders:0,revenue:0}};return e.forEach(e=>{if(e.pickup&&e.pickup.serviceDate)try{const r=Object(_.a)(e.pickup.serviceDate).getMonth();let o;a[o=r<3?"Q1":r<6?"Q2":r<9?"Q3":"Q4"].orders++;const n=parseFloat(e.invoiceTotal||0);isNaN(n)||(a[o].revenue+=n)}catch(t){}}),Object.values(a)}catch(t){return console.error("Error calculating seasonal trends:",t),[]}})(he),[he]),Object(r.useMemo)(()=>(e=>{try{const a={"0-5kg":{range:"0-5kg",count:0},"6-10kg":{range:"6-10kg",count:0},"11-15kg":{range:"11-15kg",count:0},"16-20kg":{range:"16-20kg",count:0},"21-30kg":{range:"21-30kg",count:0},"31kg+":{range:"31kg+",count:0}};return e.forEach(e=>{if(!e.cleaning||!e.cleaning.orderDetails||!e.cleaning.orderDetails.washFoldWeight)return;const t=parseFloat(e.cleaning.orderDetails.washFoldWeight);if(isNaN(t))return;let r;a[r=t<=5?"0-5kg":t<=10?"6-10kg":t<=15?"11-15kg":t<=20?"16-20kg":t<=30?"21-30kg":"31kg+"].count++}),Object.values(a)}catch(t){return console.error("Error calculating weight distribution:",t),[]}})(he),[he])),ve=(Object(r.useMemo)(()=>a.filter(e=>"LYGRRATQ7EGG2"===e.cityId).map(e=>{let t="";return e.pickup&&e.pickup.to&&(t=e.pickup.to),{id:e.appointmentId,address:t,customerType:e.customerType||"Unknown",revenue:parseFloat(e.invoiceTotal||0)}}),[a]),Object(r.useMemo)(()=>({totalOrders:he.length,totalRevenue:he.reduce((e,t)=>{const a=parseFloat(t.invoiceTotal||0);return e+(isNaN(a)?0:a)},0),totalCustomers:new Set(he.map(e=>e.customerId).filter(Boolean)).size,totalLaundromats:new Set(he.filter(e=>e.cleaning&&e.cleaning.cleaner).map(e=>e.cleaning.cleaner)).size,avgOrderValue:he.length>0?he.reduce((e,t)=>{const a=parseFloat(t.invoiceTotal||0);return e+(isNaN(a)?0:a)},0)/he.length:0,avgWeight:he.filter(e=>e.cleaning&&e.cleaning.orderDetails&&e.cleaning.orderDetails.washFoldWeight).reduce((e,t,a,r)=>{const o=parseFloat(t.cleaning.orderDetails.washFoldWeight);return a===r.length-1?(e+o)/r.length:e+o},0)}),[he])),ke=Object(r.useMemo)(()=>{if(!a||0===a.length)return[];const e={};return a.forEach(t=>{if("all"!==l&&t.cityId!==l)return;let a=null;if(t.pickup&&t.pickup.serviceDate?a=new Date(t.pickup.serviceDate):t.service_date?a=new Date(t.service_date):t.createdAt&&(a=new Date(t.createdAt)),a&&!isNaN(a.getTime())){const r=Object(R.a)(a,"yyyy-MM"),o=Object(R.a)(a,"MMM yyyy");e[r]||(e[r]={key:r,name:o,date:a,appointments:[],customers:new Set,returningCustomers:new Set}),e[r].appointments.push(t),t.customerId&&(e[r].customers.add(t.customerId),Object.keys(e).filter(t=>t!==r&&new Date(e[t].date)<a).some(a=>e[a].customers.has(t.customerId))&&e[r].returningCustomers.add(t.customerId))}}),Object.values(e).map(e=>({name:e.name,date:e.date,month:e.key,customers:e.customers.size,returningCustomers:e.returningCustomers.size,retentionRate:e.customers.size>0?e.returningCustomers.size/e.customers.size:0})).sort((e,t)=>new Date(e.date)-new Date(t.date)).filter(e=>e.customers>=3)},[a,l]),[De,Oe]=(Object(r.useMemo)(()=>{if(!a||0===a.length)return[];const e={};return a.forEach(t=>{if("all"!==l&&t.cityId!==l)return;let a=null;if(t.pickup&&t.pickup.serviceDate?a=new Date(t.pickup.serviceDate):t.service_date?a=new Date(t.service_date):t.createdAt&&(a=new Date(t.createdAt)),a&&!isNaN(a.getTime())){const r=Object(R.a)(a,"yyyy-ww"),o=Object(R.a)(a,"MMM d, yyyy");e[r]||(e[r]={key:r,name:`Week of ${o}`,shortName:Object(R.a)(a,"MMM d"),date:a,customerCount:new Set,orderCount:0}),e[r].orderCount++,t.customerId&&e[r].customerCount.add(t.customerId)}}),Object.values(e).map(e=>({name:e.shortName,fullName:e.name,date:e.date,week:e.key,customers:e.customerCount.size,orders:e.orderCount,ordersPerCustomer:e.customerCount.size>0?e.orderCount/e.customerCount.size:0})).sort((e,t)=>new Date(e.date)-new Date(t.date)).filter(e=>e.customers>=2)},[a,l]),Object(r.useMemo)(()=>{if(!a||0===a.length)return[];const e={};return a.forEach(t=>{if("all"!==l&&t.cityId!==l)return;let a=null,r=null;if(t.pickup&&t.pickup.serviceDate&&(a=new Date(t.pickup.serviceDate)),t.delivery&&t.delivery.serviceDate&&(r=new Date(t.delivery.serviceDate)),a&&r&&!isNaN(a.getTime())&&!isNaN(r.getTime())&&r>a){const t=Object(R.a)(a,"yyyy-MM"),o=Object(R.a)(a,"MMM yyyy");e[t]||(e[t]={key:t,name:o,date:a,totalHours:0,count:0});const n=(r-a)/36e5;e[t].totalHours+=n,e[t].count++}}),Object.values(e).map(e=>({name:e.name,date:e.date,month:e.key,avgProcessingHours:e.count>0?e.totalHours/e.count:0})).sort((e,t)=>new Date(e.date)-new Date(t.date)).filter(e=>e.avgProcessingHours>0)},[a,l]),Object(r.useMemo)(()=>{if(!a||0===a.length)return[];const e={};return a.forEach(t=>{if("all"!==l&&t.cityId!==l)return;let a=null;if(t.pickup&&t.pickup.serviceDate?a=new Date(t.pickup.serviceDate):t.service_date?a=new Date(t.service_date):t.createdAt&&(a=new Date(t.createdAt)),a&&!isNaN(a.getTime())){const r=Object(R.a)(a,"yyyy-MM"),o=Object(R.a)(a,"MMM yyyy");e[r]||(e[r]={key:r,name:o,date:a,residential:0,commercial:0,unknown:0,total:0}),e[r].total++,"Residential"===t.customerType?e[r].residential++:"Commercial"===t.customerType?e[r].commercial++:e[r].unknown++}}),Object.values(e).map(e=>({name:e.name,date:e.date,month:e.key,residential:e.residential,residentialPercent:e.total>0?e.residential/e.total*100:0,commercial:e.commercial,commercialPercent:e.total>0?e.commercial/e.total*100:0,unknown:e.unknown,total:e.total})).sort((e,t)=>new Date(e.date)-new Date(t.date)).filter(e=>e.total>=5)},[a,l]),Object(r.useState)("retention")),we=Object(r.useMemo)(()=>{const e=new Set;return a.forEach(t=>{t.customerType&&e.add(t.customerType)}),Array.from(e)},[a]),Me=Object(r.useMemo)(()=>{const e=new Map;return a.forEach(t=>{if(t.cleaning&&t.cleaning.cleaner){const a=t.cleaning.cleaner,r=ye[a]||`Laundromat ${a.substring(0,8)}`;e.set(a,{id:a,name:r})}}),Array.from(e.values())},[a,ye]),Ce=Object(r.useMemo)(()=>{const e={LYGRRATQ7EGG2:{lat:42.9849,lng:-81.2453},L4NE8GPX89J3A:{lat:45.4215,lng:-75.6972},LDK6Z980JTKXY:{lat:43.4643,lng:-80.5204},LXMC6DWVJ5N7W:{lat:43.2557,lng:-79.8711},LG0VGFKQ25XED:{lat:51.0447,lng:-114.0719}};return"all"!==l?e[l]:e.LYGRRATQ7EGG2},[l]),[Se,Ae]=(Object(r.useMemo)(()=>z.length,[z]),Object(r.useMemo)(()=>K.length,[K]),Object(r.useState)("orders")),[Fe,je]=Object(r.useState)("desc"),Le=e=>{Se===e?je("asc"===Fe?"desc":"asc"):(Ae(e),je("desc"))},Ge=e=>{let{column:t}=e;return Se!==t?o.a.createElement("span",{style:{opacity:.3}},"\u2195"):o.a.createElement("span",null,"asc"===Fe?"\u2191":"\u2193")},Be=Object(r.useMemo)(()=>{const e={LYGRRATQ7EGG2:{name:"London",population:4e5,laundromatCount:3,operationalSince:"2023-01-01",marketShare:ve.totalOrders/4e5*100,avgOrderFrequency:ve.totalOrders/ve.totalCustomers},L4NE8GPX89J3A:{name:"Ottawa",population:1017449,laundromatCount:5,operationalSince:"2023-03-15",marketShare:ve.totalOrders/1017449*100,avgOrderFrequency:ve.totalOrders/ve.totalCustomers},LDK6Z980JTKXY:{name:"Kitchener-Waterloo",population:575847,laundromatCount:4,operationalSince:"2023-06-01",marketShare:ve.totalOrders/575847*100,avgOrderFrequency:ve.totalOrders/ve.totalCustomers},LXMC6DWVJ5N7W:{name:"Hamilton",population:569353,laundromatCount:3,operationalSince:"2023-09-10",marketShare:ve.totalOrders/569353*100,avgOrderFrequency:ve.totalOrders/ve.totalCustomers},LG0VGFKQ25XED:{name:"Calgary",population:1306784,laundromatCount:4,operationalSince:"2023-11-20",marketShare:ve.totalOrders/1306784*100,avgOrderFrequency:ve.totalOrders/ve.totalCustomers}};return"all"===l?null:e[l]},[l,ve]),Te=Object(r.useMemo)(()=>{try{return fe&&0!==fe.length?function(e,t){try{const r=de(e,t);return{combinedOrderTrend:r.combined,weeklyHistoricalData:r.weeklyHistoricalData,projectedData:r.projectedData,metrics:r.metrics,referenceDate:Object(R.a)(new Date,"MMM d")}}catch(a){return console.error("Error generating projections:",a),{combinedOrderTrend:[],weeklyHistoricalData:[],projectedData:[],metrics:{totalAnnualOrders:0,averageMonthlyOrders:0,projectedGrowthPercent:0},referenceDate:Object(R.a)(new Date,"MMM d")}}}(fe,l):{combinedOrderTrend:[],metrics:{totalAnnualOrders:0,averageMonthlyOrders:0,projectedGrowthPercent:0}}}catch(e){return console.error("Error generating projections:",e),{combinedOrderTrend:fe,metrics:{totalAnnualOrders:0,averageMonthlyOrders:0,projectedGrowthPercent:0},error:!0}}},[fe,l]),[We,Re]=(Object(r.useMemo)(()=>{if(!fe||!Te||"all"===l)return fe;const e={};return fe.forEach(t=>{e[t.month]=t}),[...fe,...(Te.projectedData||[]).filter(t=>!e[t.month])].sort((e,t)=>e.month&&t.month?e.month.localeCompare(t.month):0)},[fe,Te,l]),Object(r.useState)(0));Object(r.useEffect)(()=>{a&&a.length>0&&Re(a.length)},[a]);const[Ie,Ne]=Object(r.useState)(0);if(Object(r.useEffect)(()=>{if(a&&a.length>0){Re(a.length);const e=a.reduce((e,t)=>{const a=parseFloat(t.invoiceTotal||0);return e+(isNaN(a)?0:a)},0);Ne(e)}},[a]),e)return o.a.createElement(d.a,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"}},o.a.createElement(m.a,null));return o.a.createElement(d.a,{sx:{flex:1,display:"flex",flexDirection:"column",bgcolor:"#F3F4F6",minHeight:"100vh"}},o.a.createElement(d.a,{component:"main",sx:{flexGrow:1,px:3,py:4}},o.a.createElement(y.a,{maxWidth:"xl"},o.a.createElement(h.a,{position:"sticky",sx:{backgroundColor:"#1E40AF",top:0,zIndex:1100,transition:"transform 0.3s ease",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(E.a,null,o.a.createElement(u.a,{variant:"h6",component:"div",sx:{flexGrow:1,fontWeight:"bold"}},"Laundry Service Analytics Dashboard"),o.a.createElement(d.a,{sx:{display:"flex",gap:1.5,flexWrap:"wrap",alignItems:"center"}},o.a.createElement(d.a,{sx:{display:"flex",flexDirection:"column",minWidth:130}},o.a.createElement(u.a,{variant:"caption",sx:{color:"white",fontWeight:"medium",mb:.3}},"City"),o.a.createElement(x.a,{variant:"filled",size:"small",sx:{backgroundColor:"white",borderRadius:"4px"}},o.a.createElement(f.a,{value:l,onChange:e=>c(e.target.value),displayEmpty:!0,sx:{color:"#1E3A8A",".MuiSelect-select":{py:1,pr:6},"&:focus":{backgroundColor:"white"},fontSize:"0.85rem"},IconComponent:()=>o.a.createElement(N.a,{sx:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"#1E3A8A",fontSize:"1.25rem"}},"expand_more")},o.a.createElement(b.a,{value:"all"},"All Cities"),o.a.createElement(b.a,{value:"LYGRRATQ7EGG2"},"London"),o.a.createElement(b.a,{value:"L4NE8GPX89J3A"},"Ottawa"),o.a.createElement(b.a,{value:"LDK6Z980JTKXY"},"Kitchener-Waterloo"),o.a.createElement(b.a,{value:"LXMC6DWVJ5N7W"},"Hamilton"),o.a.createElement(b.a,{value:"LG0VGFKQ25XED"},"Calgary")))),o.a.createElement(d.a,{sx:{display:"flex",flexDirection:"column",minWidth:100}},o.a.createElement(u.a,{variant:"caption",sx:{color:"white",fontWeight:"medium",mb:.3}},"From"),o.a.createElement(x.a,{variant:"filled",size:"small",sx:{backgroundColor:"white",borderRadius:"4px"}},o.a.createElement(f.a,{value:`${i.getFullYear()}-${i.getMonth()+1}`,onChange:e=>{const[t,a]=e.target.value.split("-");s(new Date(t,a-1,1))},displayEmpty:!0,sx:{color:"#1E3A8A",".MuiSelect-select":{py:1,pr:6},"&:focus":{backgroundColor:"white"},fontSize:"0.85rem"},IconComponent:()=>o.a.createElement(N.a,{sx:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"#1E3A8A",fontSize:"1.25rem"}},"expand_more")},[...Array(24)].map((e,t)=>{const a=Object(W.a)(new Date,t),r=`${a.getFullYear()}-${a.getMonth()+1}`,n=Object(R.a)(a,"MMM yyyy");return o.a.createElement(b.a,{key:`from-${r}`,value:r},n)})))),o.a.createElement(d.a,{sx:{display:"flex",flexDirection:"column",minWidth:100}},o.a.createElement(u.a,{variant:"caption",sx:{color:"white",fontWeight:"medium",mb:.3}},"To"),o.a.createElement(x.a,{variant:"filled",size:"small",sx:{backgroundColor:"white",borderRadius:"4px"}},o.a.createElement(f.a,{value:`${p.getFullYear()}-${p.getMonth()+1}`,onChange:e=>{const[t,a]=e.target.value.split("-");P(new Date(t,a,0))},displayEmpty:!0,sx:{color:"#1E3A8A",".MuiSelect-select":{py:1,pr:6},"&:focus":{backgroundColor:"white"},fontSize:"0.85rem"},IconComponent:()=>o.a.createElement(N.a,{sx:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"#1E3A8A",fontSize:"1.25rem"}},"expand_more")},[...Array(24)].map((e,t)=>{const a=Object(W.a)(new Date,t),r=`${a.getFullYear()}-${a.getMonth()+1}`,n=Object(R.a)(a,"MMM yyyy");return o.a.createElement(b.a,{key:`to-${r}`,value:r},n)})))),o.a.createElement(d.a,{sx:{display:"flex",flexDirection:"column",minWidth:130}},o.a.createElement(u.a,{variant:"caption",sx:{color:"white",fontWeight:"medium",mb:.3}},"Customer Type"),o.a.createElement(x.a,{variant:"filled",size:"small",sx:{backgroundColor:"white",borderRadius:"4px"}},o.a.createElement(f.a,{value:X,onChange:e=>Q(e.target.value),displayEmpty:!0,sx:{color:"#1E3A8A",".MuiSelect-select":{py:1,pr:6},"&:focus":{backgroundColor:"white"},fontSize:"0.85rem"},IconComponent:()=>o.a.createElement(N.a,{sx:{position:"absolute",right:4,top:"50%",transform:"translateY(-50%)",pointerEvents:"none",color:"#1E3A8A",fontSize:"1.25rem"}},"expand_more")},o.a.createElement(b.a,{value:"all"},"All Customer Types"),we.map(e=>o.a.createElement(b.a,{key:e,value:e},e)))))))),Be&&o.a.createElement(d.a,{sx:{mb:6}},o.a.createElement(d.a,{sx:{display:"flex",flexDirection:{xs:"column",md:"row"},justifyContent:"space-between",alignItems:{xs:"start",md:"center"},mb:4}},o.a.createElement(u.a,{variant:"h4",gutterBottom:!0,sx:{fontWeight:"bold",color:"#111827",mb:{xs:2,md:0}}},Be.name," Overview"),o.a.createElement(d.a,{sx:{display:"flex",alignItems:"center"}},o.a.createElement(N.a,{sx:{color:"#6B7280",mr:1}},"calendar_today"),o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},o.a.createElement("span",{style:{fontWeight:500}},"Operational Since:")," ",new Date(Be.operationalSince).toLocaleString("en-US",{month:"long",year:"numeric"})))),o.a.createElement(v.a,{container:!0,spacing:3},o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#EBF5FF",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#1E88E5"}},"groups")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Population"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},Be.population.toLocaleString()))))),o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#E6FFFA",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#26A69A"}},"location_on")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Active Laundromats"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},Be.laundromatCount),o.a.createElement(u.a,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"}},Me.filter(e=>{const t={};a.forEach(a=>{a.cleaning&&a.cleaning.cleaner===e.id&&a.cityId&&(t[a.cityId]=(t[a.cityId]||0)+1)});let r=null,o=0;return Object.keys(t).forEach(e=>{t[e]>o&&(o=t[e],r=e)}),r===l}).map(e=>e.name).join(", ")))))),o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#F3E8FF",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#AB47BC"}},"trending_up")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Market Penetration"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},Be.marketShare.toFixed(2),"%"),o.a.createElement(u.a,{variant:"caption",sx:{color:"text.secondary",mt:.5,display:"block"}},"Based on total population"))))),o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#FFF7ED",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#F59E0B"}},"shopping_bag")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Average Orders Per Customer"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},Be.avgOrderFrequency.toFixed(1)))))))),"all"!==l&&o.a.createElement(d.a,{sx:{mb:4}},o.a.createElement(u.a,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:"bold",color:"#111827"}},"Quarterly Growth for ","all"===l?"All Cities":H[l]),o.a.createElement(V,{selectedCity:l,cityMapping:H})),o.a.createElement(g.a,{sx:{p:3,mb:4,backgroundColor:"#EFF6FF",borderRadius:2,display:"flex",flexDirection:{xs:"column",md:"row"},alignItems:{xs:"start",md:"center"},justifyContent:"space-between",borderLeft:"5px solid #3B82F6"}},o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",color:"#1E40AF",mb:{xs:2,md:0}}},"Showing Statistics for: ","all"===l?"All Cities":H[l]),o.a.createElement(d.a,{sx:{display:"flex",alignItems:"center",backgroundColor:"white",px:2,py:1,borderRadius:1,boxShadow:"0 1px 2px rgba(0,0,0,0.1)"}},o.a.createElement(N.a,{sx:{color:"#3B82F6",mr:1}},"date_range"),o.a.createElement(u.a,{variant:"body1",sx:{mr:1,color:"#1E40AF",fontWeight:"medium"}},"From: ",Object(R.a)(i,"MMM yyyy")),o.a.createElement(u.a,{variant:"body1",sx:{color:"#1E40AF",fontWeight:"medium"}},"To: ",Object(R.a)(p,"MMM yyyy")))),o.a.createElement(u.a,{variant:"h5",gutterBottom:!0,sx:{mb:3,fontWeight:"bold",color:"#111827"}},"Performance Metrics"),o.a.createElement(v.a,{container:!0,spacing:3,sx:{mb:4}},o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#EBF5FF",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#2563EB"}},"shopping_bag")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Total Orders"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},ve.totalOrders.toLocaleString()))))),o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#ECFDF5",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#10B981"}},"attach_money")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Total Revenue"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},"$",ve.totalRevenue.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})))))),o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#FEF3C7",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#F59E0B"}},"trending_up")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Avg. Order Value"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},"$",ve.avgOrderValue.toFixed(2)))))),o.a.createElement(v.a,{item:!0,xs:12,sm:6,md:3},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{display:"flex",alignItems:"flex-start"}},o.a.createElement(d.a,{sx:{backgroundColor:"#F3E8FF",borderRadius:"50%",p:1.5,mr:2}},o.a.createElement(N.a,{sx:{color:"#8B5CF6"}},"inventory_2")),o.a.createElement(d.a,null,o.a.createElement(u.a,{variant:"body2",color:"text.secondary"},"Avg. Order Weight"),o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",mt:.5}},ve.avgWeight.toFixed(2)," kg")))))),o.a.createElement(u.a,{variant:"h5",gutterBottom:!0,sx:{mt:6,mb:3,fontWeight:"bold",color:"#111827"}},"all"===l?"All Cities":H[l]," Order Trends"),o.a.createElement(v.a,{container:!0,spacing:3,sx:{mb:4}},o.a.createElement(v.a,{item:!0,xs:12,md:8},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(u.a,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"medium",color:"#4B5563"}},"Weekly Orders - ","all"===l?"All Cities":H[l]),o.a.createElement(D.a,{width:"100%",height:300},o.a.createElement(O.a,{data:"all"===l?fe:(null===Te||void 0===Te?void 0:Te.weeklyHistoricalData)||fe},o.a.createElement(w.a,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),o.a.createElement(M.a,{dataKey:"name",tick:{fill:"#6B7280"},interval:"preserveStartEnd",minTickGap:15,tickMargin:8}),o.a.createElement(C.a,{tick:{fill:"#6B7280"}}),o.a.createElement(S.a,{contentStyle:{backgroundColor:"#FFFFFF",borderRadius:"0.375rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",border:"none"},formatter:(e,t,a)=>[`${e} orders`,t],labelFormatter:(e,t)=>{var a;const r=null===t||void 0===t?void 0:null===(a=t[0])||void 0===a?void 0:a.payload;return(null===r||void 0===r?void 0:r.fullname)||e}}),o.a.createElement(A.a,{wrapperStyle:{paddingTop:"10px"}}),"all"===l?Object.values(H).filter(e=>"All Cities"!==e).map((e,t)=>o.a.createElement(F.a,{key:e,type:"monotone",dataKey:e,stroke:me[t%me.length],strokeWidth:2,dot:{r:3,strokeWidth:1,fill:me[t%me.length]},activeDot:{r:6},isAnimationActive:!0,animationDuration:1e3,connectNulls:!0})):o.a.createElement(F.a,{type:"monotone",dataKey:"orders",name:H[l],stroke:"#2563EB",strokeWidth:2,dot:{r:3,strokeWidth:1,fill:"#2563EB"},activeDot:{r:6},isAnimationActive:!0,animationDuration:1e3,connectNulls:!0}))))),o.a.createElement(v.a,{item:!0,xs:12,md:4},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(u.a,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"medium",color:"#4B5563"}},"Customer Types"),o.a.createElement(D.a,{width:"100%",height:300},o.a.createElement(j.a,null,o.a.createElement(L.a,{data:xe,cx:"50%",cy:"50%",labelLine:!1,outerRadius:100,fill:"#8884d8",dataKey:"value",label:e=>{let{name:t,percent:a}=e;return`${t}: ${(100*a).toFixed(0)}%`}},xe.map((e,t)=>o.a.createElement(G.a,{key:`cell-${t}`,fill:me[t%me.length]}))),o.a.createElement(S.a,{contentStyle:{backgroundColor:"#FFFFFF",borderRadius:"0.375rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",border:"none"},formatter:e=>[`${e} orders`,"Count"]}),o.a.createElement(A.a,{wrapperStyle:{paddingTop:"10px"}})))))),o.a.createElement(v.a,{container:!0,spacing:3,sx:{mb:5}},o.a.createElement(v.a,{item:!0,xs:12,md:6},o.a.createElement(g.a,{sx:{p:2,height:"100%"}},o.a.createElement(d.a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:2}},o.a.createElement(u.a,{variant:"h6"},"Customer Retention Over Time")),o.a.createElement(D.a,{width:"100%",height:300},o.a.createElement(O.a,{data:ke},o.a.createElement(w.a,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),o.a.createElement(M.a,{dataKey:"name",tick:{fill:"#6B7280"}}),o.a.createElement(C.a,{tickFormatter:e=>`${(100*e).toFixed(0)}%`,domain:[0,e=>Math.min(1,1.1*e)],tick:{fill:"#6B7280"}}),o.a.createElement(S.a,{contentStyle:{backgroundColor:"#FFFFFF",borderRadius:"0.375rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",border:"none"},formatter:e=>[`${(100*e).toFixed(1)}%`,"Retention Rate"]}),o.a.createElement(F.a,{type:"monotone",dataKey:"retentionRate",stroke:"#3B82F6",strokeWidth:2,dot:{r:4,strokeWidth:1,fill:"#3B82F6"},activeDot:{r:6}}))))),o.a.createElement(v.a,{item:!0,xs:12,md:6},o.a.createElement(g.a,{sx:{p:3,height:"100%",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(u.a,{variant:"h6",gutterBottom:!0,sx:{fontWeight:"medium",color:"#4B5563"}},"Order Weight Distribution"),o.a.createElement(D.a,{width:"100%",height:300},o.a.createElement(B.a,{data:be},o.a.createElement(w.a,{strokeDasharray:"3 3",stroke:"#E5E7EB"}),o.a.createElement(M.a,{dataKey:"range",tick:{fill:"#6B7280"}}),o.a.createElement(C.a,{tick:{fill:"#6B7280"}}),o.a.createElement(S.a,{contentStyle:{backgroundColor:"#FFFFFF",borderRadius:"0.375rem",boxShadow:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)",border:"none"},formatter:e=>[`${e} orders`,"Count"]}),o.a.createElement(A.a,{wrapperStyle:{paddingTop:"10px"}}),o.a.createElement(T.a,{dataKey:"count",fill:"#26A69A",name:"Number of Orders"})))))),o.a.createElement(u.a,{variant:"h5",gutterBottom:!0,sx:{mt:6,mb:3,fontWeight:"bold",color:"#111827"}},"Laundromat Performance"),o.a.createElement(d.a,{sx:{mb:2,display:"flex",alignItems:"center"}},o.a.createElement(u.a,{variant:"body1",color:"text.secondary"},"all"!==l?`Showing all laundromats with ${H[l]} laundromats highlighted`:"Showing all laundromats across cities"),"all"!==l&&o.a.createElement(d.a,{sx:{display:"inline-block",marginLeft:"10px",padding:"2px 8px",backgroundColor:"#FEF08A",color:"#854D0E",borderRadius:"4px",fontSize:"0.875rem",fontWeight:"medium"}},H[l]," Highlighted")),o.a.createElement(g.a,{sx:{p:0,mb:4,overflowX:"auto",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,{sx:{p:3,borderBottom:"1px solid #E5E7EB"}},o.a.createElement(v.a,{container:!0,spacing:2},o.a.createElement(v.a,{item:!0,xs:12,md:3},o.a.createElement(x.a,{fullWidth:!0,variant:"outlined",size:"small"},o.a.createElement(k.a,null,"Filter by Laundromat"),o.a.createElement(f.a,{value:$,onChange:e=>te(e.target.value),label:"Filter by Laundromat"},o.a.createElement(b.a,{value:"all"},"All Laundromats"),Me.map(e=>o.a.createElement(b.a,{key:e.id,value:e.id},e.name))))))),o.a.createElement(d.a,null,o.a.createElement("table",{style:{width:"100%",borderCollapse:"collapse"}},o.a.createElement("thead",null,o.a.createElement("tr",{style:{backgroundColor:"#F9FAFB"}},o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("name")},"Laundromat Name ",o.a.createElement(Ge,{column:"name"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("city")},"City ",o.a.createElement(Ge,{column:"city"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("orders")},"Total Orders ",o.a.createElement(Ge,{column:"orders"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("revenue")},"Revenue ",o.a.createElement(Ge,{column:"revenue"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("avgOrderValue")},"Avg. Order Value ",o.a.createElement(Ge,{column:"avgOrderValue"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("customers")},"Customers ",o.a.createElement(Ge,{column:"customers"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("returningCustomers")},"Returning ",o.a.createElement(Ge,{column:"returningCustomers"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("retentionScore")},"Retention ",o.a.createElement(Ge,{column:"retentionScore"})),o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280",cursor:"pointer"},onClick:()=>Le("avgTurnaroundDays")},"Turnaround ",o.a.createElement(Ge,{column:"avgTurnaroundDays"})))),o.a.createElement("tbody",null,(()=>{let e=Ee;return e=e.filter(e=>e.revenue>0||e.orders>=1),[...e].sort((e,t)=>{let a,r;switch(Se){case"name":a=ye[e.id]||e.id,r=ye[t.id]||t.id;break;case"city":a=e.city||"",r=t.city||"";break;case"avgOrderValue":a=e.orders>0?e.revenue/e.orders:0,r=t.orders>0?t.revenue/t.orders:0;break;case"retentionScore":a=e.returningCustomers&&e.customers?e.returningCustomers/e.customers:0,r=t.returningCustomers&&t.customers?t.returningCustomers/t.customers:0;break;default:a=e[Se],r=t[Se]}return"string"===typeof a&&"string"===typeof r?"asc"===Fe?a.localeCompare(r):r.localeCompare(a):"asc"===Fe?a-r:r-a}).sort((e,t)=>t.orders-e.orders).slice(0,15).map(e=>{const t="all"!==l&&(e.city===H[l]||e.cityId===l),a=e.customers||e.customerCount||0,r=e.returningCustomers||e.returningCustomerCount||0,n=a>0?r/a:0;return o.a.createElement("tr",{key:e.id,style:{borderBottom:"1px solid #E5E7EB"}},o.a.createElement("td",{style:{padding:"12px 16px"}},t&&o.a.createElement(N.a,{sx:{color:"#EAB308",verticalAlign:"middle",marginRight:"6px",fontSize:"1.2rem"}},"star"),ye[e.id]||e.id),o.a.createElement("td",{style:{padding:"12px 16px"}},e.city||H[e.cityId]||"Unknown"),o.a.createElement("td",{style:{padding:"12px 16px"}},e.orders.toLocaleString()),o.a.createElement("td",{style:{padding:"12px 16px"}},"$",e.revenue.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),o.a.createElement("td",{style:{padding:"12px 16px"}},"$",e.orders>0?(e.revenue/e.orders).toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2}):"0.00"),o.a.createElement("td",{style:{padding:"12px 16px"}},a.toLocaleString()),o.a.createElement("td",{style:{padding:"12px 16px"}},r.toLocaleString()),o.a.createElement("td",{style:{padding:"12px 16px"}},o.a.createElement("div",{style:{display:"flex",alignItems:"center"}},o.a.createElement("span",{style:{width:"12px",height:"12px",borderRadius:"50%",marginRight:"8px",backgroundColor:n>=.6?"#10B981":n>=.45?"#059669":n>=.35?"#F59E0B":n>=.25?"#D97706":n>=.15?"#DC2626":"#B91C1C"}}),(100*n).toFixed(1),"%")),o.a.createElement("td",{style:{padding:"12px 16px"}},e.avgTurnaroundDays?e.avgTurnaroundDays.toFixed(1):"\u2014"," days"))})})())))),o.a.createElement(u.a,{variant:"h5",gutterBottom:!0,sx:{mt:6,mb:3,fontWeight:"bold",color:"#111827"}},"City Performance"),o.a.createElement(g.a,{sx:{p:0,mb:4,overflowX:"auto",borderRadius:2,boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"}},o.a.createElement(d.a,null,o.a.createElement("table",{style:{width:"100%",borderCollapse:"collapse"}},o.a.createElement("thead",null,o.a.createElement("tr",{style:{backgroundColor:"#F9FAFB"}},o.a.createElement("th",{style:{padding:"16px",textAlign:"left",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"City"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"In Operation"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"Total Orders"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"Revenue"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"Avg. Order Value"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"Customers"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"Returning"),o.a.createElement("th",{style:{padding:"16px",textAlign:"right",borderBottom:"1px solid #E5E7EB",fontWeight:500,fontSize:"0.75rem",textTransform:"uppercase",letterSpacing:"0.05em",color:"#6B7280"}},"Retention"))),o.a.createElement("tbody",null,Object.keys(H).filter(e=>"all"!==e).map(e=>{const t=a.filter(t=>t.cityId===e||oe(t)===e),r=t.length,n=t.reduce((e,t)=>{const a=parseFloat(t.invoiceTotal||0);return e+(isNaN(a)?0:a)},0),c=r>0?n/r:0,i=new Set,s={};t.forEach(e=>{e.customerId&&(i.add(e.customerId),s[e.customerId]||(s[e.customerId]=0),s[e.customerId]++)});const d=i.size,m=Object.values(s).filter(e=>e>1).length,u=d>0?m/d:0,p=e===l;let g,y;const h=new Date;switch(e){case"LYGRRATQ7EGG2":g=new Date("2022-01-01");break;case"L4NE8GPX89J3A":g=new Date("2023-03-15");break;case"LDK6Z980JTKXY":g=new Date("2023-06-01");break;case"LXMC6DWVJ5N7W":g=new Date("2023-09-10");break;case"LG0VGFKQ25XED":g=new Date("2023-11-20");break;default:g=new Date("2022-01-01")}return y=(Math.abs(h-g)/315576e5).toFixed(1),o.a.createElement("tr",{key:e,style:{borderBottom:"1px solid #E5E7EB"}},o.a.createElement("td",{style:{padding:"12px 16px",fontWeight:500}},p&&o.a.createElement(N.a,{sx:{color:"#EAB308",verticalAlign:"middle",marginRight:"6px",fontSize:"1.2rem"}},"star"),H[e]),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},y," years"),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},r.toLocaleString()),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},"$",n.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},"$",c.toLocaleString(void 0,{minimumFractionDigits:2,maximumFractionDigits:2})),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},d.toLocaleString()),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},m.toLocaleString()),o.a.createElement("td",{style:{padding:"12px 16px",textAlign:"right"}},o.a.createElement("div",{style:{display:"flex",alignItems:"center",justifyContent:"flex-end"}},o.a.createElement("span",{style:{width:"12px",height:"12px",borderRadius:"50%",marginRight:"8px",backgroundColor:u>=.6?"#10B981":u>=.45?"#059669":u>=.35?"#F59E0B":u>=.25?"#D97706":u>=.15?"#DC2626":"#B91C1C"}}),(100*u).toFixed(1),"%")))}))))),o.a.createElement(d.a,{sx:{mb:4}},o.a.createElement(d.a,{sx:{display:"flex",justifyContent:"space-between",alignItems:"center",mb:3}},o.a.createElement(u.a,{variant:"h5",sx:{fontWeight:"bold",color:"#111827"}},"Order Locations - ",H[l]||"All Cities")),o.a.createElement(g.a,{sx:{borderRadius:2,overflow:"hidden",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)",height:"450px",position:"relative"}},o.a.createElement(I.a,{bootstrapURLKeys:{key:"AIzaSyAtGuXvA4E3HW0xM2yzRU7tphMTtxqKQD4",libraries:["places"]},center:ne||Ce,zoom:ce,onChange:e=>{let{center:t,zoom:a,bounds:r}=e;le(t),ie(a)},options:{fullscreenControl:!0,zoomControl:!0,mapTypeControl:!0,streetViewControl:!1,gestureHandling:"greedy",minZoom:5,maxZoom:18,styles:[{featureType:"all",elementType:"geometry",stylers:[{lightness:20}]},{featureType:"water",elementType:"geometry",stylers:[{color:"#e0f2fe"}]},{featureType:"road",elementType:"geometry",stylers:[{color:"#f1f5f9"}]}]}}),o.a.createElement(d.a,{sx:{position:"absolute",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(255, 255, 255, 0.85)",display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",zIndex:10}},o.a.createElement(d.a,{sx:{backgroundColor:"#3B82F6",color:"white",padding:"12px 24px",borderRadius:"8px",boxShadow:"0 4px 6px -1px rgba(0, 0, 0, 0.1)",marginBottom:"16px"}},o.a.createElement(u.a,{variant:"h4",sx:{fontWeight:"bold"}},"Coming Soon!")),o.a.createElement(u.a,{variant:"body1",sx:{maxWidth:"450px",textAlign:"center",color:"#1F2937"}},"Our team is working on integrating detailed map data for all service areas. Check back soon for a visual representation of our order locations.")))))),o.a.createElement(d.a,{component:"footer",sx:{p:3,backgroundColor:"#F1F5F9",borderTop:"1px solid #E2E8F0"}},o.a.createElement(u.a,{variant:"body2",color:"text.secondary",align:"center"},"Laundry Service Analytics Dashboard \u2022 Last updated: ",(new Date).toLocaleDateString())))},pe=a(374);const ge=Object(pe.a)("https://cnbpmepdmtpgrbllufcb.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImNuYnBtZXBkbXRwZ3JibGx1ZmNiIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzc5MjM4MjEsImV4cCI6MjA1MzQ5OTgyMX0.UqDleR4ucntrg9x6FNgJigKZjKiATFYiMiLiZZj3B2w");var ye=()=>{const[e,t]=Object(r.useState)(!0),[a,n]=Object(r.useState)(null),[l,c]=Object(r.useState)(null);Object(r.useEffect)(()=>{(async()=>{try{t(!0),console.log("Fetching data from Supabase...");const{data:a,error:r}=await ge.from("appointments").select("*");if(r)throw console.error("Supabase error:",r),new Error(`Failed to load data from Supabase: ${r.message}`);if(a&&a.length>0)console.log(`Successfully loaded ${a.length} records from Supabase`),n(a);else{console.log("No data found in Supabase, falling back to local JSON file");const e=await fetch("/appointments.json");if(!e.ok)throw new Error(`Failed to load local data: ${e.status} ${e.statusText}`);const t=await e.json();n(t)}}catch(e){console.error("Error loading data:",e),c(e.message||"Failed to load data")}finally{t(!1)}})()},[]);const i=()=>{c(null),t(!0),(async()=>{try{const{data:a,error:r}=await ge.from("appointments").select("*");if(r)throw console.error("Supabase error:",r),new Error(`Failed to load data from Supabase: ${r.message}`);if(a&&a.length>0)console.log(`Successfully loaded ${a.length} records from Supabase`),n(a);else{console.log("No data found in Supabase, falling back to local JSON file");const e=await fetch("/appointments.json");if(!e.ok)throw new Error(`Failed to load local data: ${e.status} ${e.statusText}`);const t=await e.json();n(t)}}catch(e){console.error("Error loading data:",e),c(e.message||"Failed to load data")}finally{t(!1)}})()};return e?o.a.createElement(d.a,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#F3F4F6"}},o.a.createElement(m.a,{size:60,sx:{mb:3}}),o.a.createElement(u.a,{variant:"h6",color:"text.secondary"},"Loading laundry service data...")):l?o.a.createElement(d.a,{sx:{display:"flex",flexDirection:"column",justifyContent:"center",alignItems:"center",height:"100vh",backgroundColor:"#F3F4F6",p:3}},o.a.createElement(u.a,{variant:"h5",color:"error",gutterBottom:!0},"Error Loading Data"),o.a.createElement(u.a,{variant:"body1",color:"text.secondary",sx:{mb:3,maxWidth:600,textAlign:"center"}},l),o.a.createElement(p.a,{variant:"contained",color:"primary",onClick:i},"Retry")):o.a.createElement(ue,{jsonData:a})};const he=Object(c.a)({palette:{primary:{main:"#1E3A8A"},secondary:{main:"#10B981"},background:{default:"#F3F4F6"}},typography:{fontFamily:["-apple-system","BlinkMacSystemFont",'"Segoe UI"',"Roboto",'"Helvetica Neue"',"Arial","sans-serif"].join(","),h5:{fontWeight:600},h6:{fontWeight:600}},components:{MuiPaper:{defaultProps:{elevation:0},styleOverrides:{root:{boxShadow:"0px 2px 4px rgba(0, 0, 0, 0.05)"}}},MuiButton:{styleOverrides:{root:{textTransform:"none",borderRadius:8}}},MuiSelect:{styleOverrides:{root:{borderRadius:8}}}}});l.a.createRoot(document.getElementById("root")).render(o.a.createElement(o.a.StrictMode,null,o.a.createElement(i.a,{theme:he},o.a.createElement(s.a,null),o.a.createElement(ye,null))))}},[[399,1,2]]]);
//# sourceMappingURL=main.ea5d66ed.chunk.js.map